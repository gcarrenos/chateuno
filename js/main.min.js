
function guid() {
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
      .toString(16)
      .substring(1);
  }
  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
    s4() + '-' + s4() + s4() + s4();
}


function startPayment(elUsuario, elProducto, Amount, elProductoId){
    
    referenceId = guid();
    jQuery.ajax({
            url: "https://payments.opencheckout.co/api/security-token.json",
            type: "POST",
            data: {
                "CURRENCY": "USD",
                "CONFIG_CHECKOUT": {
                    "BILLING": "1",
                    "SHIPPING": "0",
                    "TICKETS": "0"
                },
                "PRODUCTOS": [
                    {
                        "PROD_PRECIO":   Amount,
                        "PROD_CODIGO":   elProductoId,
                        "PROD_CANTIDAD": "1",
                        "PROD_NOMBRE": elProducto
                    }
                ],
                "REFERENCE": referenceId,
                "KEY": "30a33f45faa75a1e8c3844671a491fc7"
            }
        })
        .done(function(data, textStatus, jqXHR) {
            var tokenRedireccionador = data.token;
            console.log(elUsuario);
            // second request
            jQuery.ajax({
                url: "https://dev.biialab.org:1992/payment/proccess",
                type: "POST",
                data:{
                    "userID": elUsuario,
                    "REFERENCE": referenceId,
                    "token": tokenRedireccionador,
                    "producto": elProducto,
                    "amount": Amount
                }
            })
            .done(function(data, textStatus, jqXHR) {
                console.log(data);
                console.log(tokenRedireccionador)
                window.location = "https://payments.opencheckout.co/payment/create?TOKEN="+tokenRedireccionador;
            })
            .fail(function(jqXHR, textStatus, errorThrown) {
                console.log("HTTP Request Failed");
            })
            .always(function() {
                /* ... */
            });
        })
        .fail(function(jqXHR, textStatus, errorThrown) {
            console.log("HTTP Request Failed");
        })
        .always(function() {
            /* ... */
        });

}



$(document).ready(function () {

    //jQuery("header .row.text-center .col-md-6.p0 > a").attr("href", "http://www.tourlecturaveloz.com/mexico-26");

    function o() {
        var o = $(window).height();
        $("#sidebar").css("height", o - 120)
    }
    $("#sidebar").length && (o(), $("#sidebar").mCustomScrollbar({theme: "minimal-dark"}), $(window).resize(function () {
        o(), $("#sidebar").mCustomScrollbar({theme: "minimal-dark"})
    }), setTimeout(function () {
        $(".categoria_dump").hide();
        var o = '<h3 class="title_cat">Categorías</h3>';
        $("#sidebar").prepend(o), $("#sidebar").hcSticky({top: 70, onStart: function () {
            }, onStop: function () {
            }})
    }, 200)), $("#sidebar_cnt").length && setTimeout(function () {
        $("#sidebar_cnt").hcSticky({top: 0, onStart: function () {
                console.log("iniciando...")
            }, onStop: function () {
                console.log("Finalizando...")
            }})
    }, 200);
    
    $('#idformLogin').validate({
        rules: {
            email: {
                required: true,
                email: true
              },
            password: "required",
            
        },messages: {
            email: 'Ingrese su correo electrónico.',
            password: 'Ingrese su password',
            
        },
        submitHandler: function(form){
            var data = $(form).serialize();
            $.ajax({
                url: '/login',
                data: data,
                type: 'POST',
                beforeSend: function() {
                    $("form").append('<div class="loading_form"><span></span></div>');
                },
                success: function(result) {
                    
                    $('.loading_form').remove();
                    
                    if(result.status == 1){
                        location.href=result.url

                    } else {
                        $(form)[0].reset();
                        $('#form-result-valido').html('<div role="alert" class="alert alert-warning">'
                                + result.message +'</div>');
                    }
                },
                dataType: 'json'
            });
            return false;
        }
    });
    
    $('#idformRegistro').validate({
        rules: {
            username: {
                required: true
            },
            lastname:
            {
                required: true,
            },
            email: {
                required: true,
                 email: true
            },
            password: {
                required: true
                 
            },
            
        },
            messages: {
            username: 'Ingrese su nombre.',
            lastname: 'Ingrese su apellido',    
            email: 'Ingrese su correo electrónico.',
            password: 'Ingrese su password'
            
        },
        
        submitHandler: function(form){
            var data = $(form).serialize();
            $.ajax({
                url: '/register',
                data: data,
                type: 'POST',
                beforeSend: function() {
                    $("form").append('<div class="loading_form"><span></span></div>');
                    
                },
                success: function(result) {
                    
                    $('.loading_form').remove();
                    if(result.status == 1){
                        
                        location.href=result.url;

                    } else {
                        //$(form)[0].reset();
                        //console.log(result)
                        $('#idformRegistro').prepend('<div role="alert" class="alert alert-warning">Correo ya existe.</div>');

                    }
                },
            });
            return false;
        }
    });
    
    
});
var obj = new Object;
obj = {sliderHome: function () {
        $(".slider-banner").slick({centerMode: !0, centerPadding: "400px", dots: !0, responsive: [{breakpoint: 1600, settings: {arrows: !1, centerMode: !0, centerPadding: "300px", slidesToShow: 1}}, {breakpoint: 1400, settings: {arrows: !1, centerMode: !0, centerPadding: "200px", slidesToShow: 1}}, {breakpoint: 1200, settings: {arrows: !1, centerMode: !0, centerPadding: "100px", slidesToShow: 1}}, {breakpoint: 992, settings: {arrows: !1, centerMode: !0, centerPadding: "80px", slidesToShow: 1}}, {breakpoint: 768, settings: {arrows: !1, centerMode: !0, centerPadding: "40px", slidesToShow: 1}}, {breakpoint: 480, settings: {arrows: !1, centerMode: !0, centerPadding: "0px", slidesToShow: 1}}]})
    }, menuMovil: function () {
        var o = new Slideout({panel: document.getElementById("wrapper"), menu: document.getElementById("menu"), padding: 256, tolerance: 70});
        document.querySelector(".js-slideout-toggle").addEventListener("click", function () {
            o.toggle()
        }), document.querySelector(".menu").addEventListener("click", function (e) {
            "A" === e.target.nodeName && o.close()
        })
    }, accordion: function () {
        function o(o) {
            $(o.target).prev(".panel-heading").find("span").toggleClass("icon-down icon-up")
        }
        $("#accordion").on("hidden.bs.collapse", o), $("#accordion").on("shown.bs.collapse", o)
    }, expandSearch: function () {
        var o = $(".sb-icon-search"), e = $(".sb-search-input"), t = $(".sb-search"), n = !1;
        o.click(function () {
            0 == n ? (t.addClass("sb-search-open"), e.focus(), n = !0) : (t.removeClass("sb-search-open"), e.focusout(), n = !1)
        }), o.mouseup(function () {
            return!1
        }), t.mouseup(function () {
            return!1
        }), $(document).mouseup(function () {
            1 == n && ($(".sb-icon-search").css("display", "block"), o.click())
        })
    }, ratingJS: function (o, e) {
        $("#start_biia").raty({click: function (o, t) {
                og.saveCalificacion || e || $.ajax({method: "POST", url: "/site/producto/calificacion", data: {productoid: $(this).attr("class"), score: o}}).done(function () {
                    og.saveCalificacion = !0
                })
            }, score: o})
    }, respuestaUnica: function (o) {
        var e = $(o + " ul li a");
        e.click(function (o) {
            o.preventDefault();
            var t = $(this), n = t.data("idp");
            e.removeClass("active"), t.addClass("active"), e.find("input").val(""), t.find("input").val(n)
        })
    }, respuestaMultiple: function (o) {
        var e = $(o + " ul li a");
        e.click(function (o) {
            o.preventDefault();
            var e = $(this), t = e.data("idp");
            $(this).hasClass("active") ? (e.removeClass("active"), e.find("input").val("")) : (e.addClass("active"), e.find("input").val(t))
        })
    }}, og = {}, og.paid = 0, og.createOption = function (o) {
    var e = '<option value="">Seleccione</option>', t = "";
    $.each(o, function (o, n) {
        e += '<option tag="' + n.type + '" value="' + n.name + '">' + n.name + "</option>", t += '<li><img src="' + og.getStatic + "img/icons/pm/" + n.nameImage + '" alt="' + n.name + '"></li>'
    }), t += '<li><img src="' + og.getStatic + 'img/bscotibank.png"></li>', t += '<li><img src="' + og.getStatic + 'img/bamerica.png"></li>', t += '<li><img src="' + og.getStatic + 'img/bcolombia.png"></li>', $("#cbxPayment").html(e), $("#idImagesPay").html(t)
}, og.getPaymentMethod = function (o) {
    var e = '<li style="width:100%;margin-right:0;"><div class="loading-gif" style="width:100%;text-align:center;"><img src="' + og.getStatic + 'img/loading.gif" /></div></li>';
    $("#idImagesPay").html(e), $.ajax({url: og.getContent + "pgp/payment/payment-methods", data: {country: o}, type: "POST", dataType: "json", success: function (o) {
            og.createOption(o)
        }, error: function (o, e, t) {
            console.dir("NOT")
        }, complete: function (o, e) {
        }})
}, og.guardarFormulario = function (o) {
    og.formaPago = o;
    var e = "&ip=" + og.site.ip;
    e += "&formaPago=" + og.formaPago, e += "&" + $("#formPagos").serialize();
    var t = '<div id="modalLoad" style="width:100%;text-align:center;position: absolute;top: 10px;z-index: 9999;"><img src="' + og.getStatic + 'img/loading.gif" /></div>';
    return $("body").prepend(t), $.ajax({url: og.getContent + "pgp/payment/save-order", data: e, type: "POST", dataType: "json", success: function (o) {
            o.status > 0 ? (og.paid = o.data.paid, "PE" == og.formaPago ? location.href = o.data.redirect : "OT" == og.formaPago ? ($("#modalWU").html(o.html), $("#modalWU").modal()) : location.href = og.getContent + "pgp/complete/" + o.data.paid) : jAlert(o.message, ""), $("#modalLoad").remove(), $("#cbxPayment").attr("value", "")
        }, error: function (o, e, t) {
            jAlert("Error de conexion, por favor vuelva a intentarlo.", ""), $("#modalLoad").remove()
        }, complete: function (o, e) {
        }}), !1
}, og.postAndRedirect = function (o, e) {
    var t = "<form method='POST' action='" + o + "'>\n";
    for (var n in e)
        e.hasOwnProperty(n) && (t += "<input type='hidden' name='" + n + "' value='" + e[n] + "'></input>");
    t += "</form>";
    var a = $(t);
    $("body").append(a), $(a).submit()
}, og.popupSocial = function (o, e) {
    e.preventDefault();
    var t = $(o), n = "";
    n = t.data("href") ? t.data("href") : t.attr("href"), window.open(n, "og_popup", "width=500,height=450,menubar=no,status=no,location=no,toolbar=no,scrollbars=yes,directories=no")
}, $(document).ready(function () {
    $("#countries").change(function () {
        og.getPaymentMethod(this.value)
    }), $("#cbxPayment").change(function () {
        var o = $("option:selected", this), e = o.attr("tag");
        "PE" == e && og.guardarFormulario(e), "OT" == e && og.guardarFormulario(e)
    }), $("#modalPay").on("hidden.bs.modal", function () {
        location.href = "http://payment.biialab.org/pgp/pending/" + og.paid
    }), $("#modalWU").on("hidden.bs.modal", function () {
        location.href = "http://payment.biialab.org/pgp/pending/" + og.paid
    })
}), og.renderView = function (o, e) {
    $("#idProductosLoad").load(og.getContent + "site/index/load?categoria=" + o + "&filter=" + e, function () {
    })
}, og.pagarSuscripcion = function (o) {
    $("#idTipoSuscripcion").attr("value", o), $("#idFormaPagos").submit()
}, og.enviarCurso = function (o) {
    $("#idformSendCursos").submit()
}, og.enviarPagosProgramaCertificado = function () {
    $("#idFormProcesarPago").submit()
};
